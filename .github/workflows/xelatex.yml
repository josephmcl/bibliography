name: Build and Update PDF Release

on:
  push:
    branches:
      - main

jobs:
  build_and_release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Compile PDF via Make
        uses: xu-cheng/texlive-action@v2
        with:
          run: |
            make

      - name: Upload PDF to Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Use GitHub CLI to create or update the 'latest' release
          # --clobber overwrites existing files of the same name
          gh release delete latest --yes || true
          gh release create latest ./build/Bibliography.pdf --title "Latest Bibliography" --notes "Automated build from latest push."
